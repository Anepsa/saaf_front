(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{l4cn:function(e,t,n){"use strict";var o=n("q1tI"),s=n.n(o),r=n("eoB5"),a=n("LvDl"),i=n.n(a),c=n("TSYQ"),l=n.n(c),m=n("dtw8");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function CommentInput(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CommentInput),(t=function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}(this,_getPrototypeOf(CommentInput).call(this,e))).state={body:e.value||"",suggestionsOpen:!1,search:"",focused:-1,cursorPosition:0,searchStartIndex:-1},t.tags=e.tags||{},t.suggestionsList=null,t.handleConfirm=t.handleConfirm.bind(_assertThisInitialized(t)),t.handleChange=t.handleChange.bind(_assertThisInitialized(t)),t.handleKeyDown=t.handleKeyDown.bind(_assertThisInitialized(t)),t.getDefaultSearchState=t.getDefaultSearchState.bind(_assertThisInitialized(t)),t.searchFilter=t.searchFilter.bind(_assertThisInitialized(t)),t.addTag=t.addTag.bind(_assertThisInitialized(t)),t.removeUnusedTags=t.removeUnusedTags.bind(_assertThisInitialized(t)),t.getFilteredTeamUsers=t.getFilteredTeamUsers.bind(_assertThisInitialized(t)),t.replaceSearchWithUsername=t.replaceSearchWithUsername.bind(_assertThisInitialized(t)),t.setSuggestionsRef=t.setSuggestionsRef.bind(_assertThisInitialized(t)),t.scrollFocusedSuggestionIntoView=t.scrollFocusedSuggestionIntoView.bind(_assertThisInitialized(t)),t.removeUnusedTags=i.a.debounce(t.removeUnusedTags,200),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(CommentInput,o["Component"]),function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(CommentInput,[{key:"componentDidUpdate",value:function componentDidUpdate(e,t){this.props.resetAfterLoad&&!this.props.loading&&e.loading&&this.setState({body:""}),this.state.suggestionsOpen&&t.focused!==this.state.focused&&this.scrollFocusedSuggestionIntoView()}},{key:"getDefaultSearchState",value:function getDefaultSearchState(){return{suggestionsOpen:!1,search:"",focused:-1,searchStartIndex:-1}}},{key:"getFilteredTeamUsers",value:function getFilteredTeamUsers(){return this.props.teamUsers.filter(this.searchFilter)}},{key:"handleConfirm",value:function handleConfirm(){this.state.body.trim()&&this.state.body.trim()!==this.props.value&&this.props.onConfirm(this.state.body,this.tags)}},{key:"addTag",value:function addTag(e){this.tags["@".concat(e.username)]={type:"user",id:"".concat(e.id)}}},{key:"removeUnusedTags",value:function removeUnusedTags(e){var t=this,n=[];i.a.isEmpty(this.tags)||(Object.keys(this.tags).forEach(function(t){e.indexOf(t)<0&&n.push(t)}),n.forEach(function(e){delete t.tags[e]}))}},{key:"handleChange",value:function handleChange(e){var t=this,n=e.target.value,o=e.target.selectionStart;this.setState(function(e){var s=n.length,r=e.body.length,a={body:n,cursorPosition:o};if(e.suggestionsOpen){var i=e.searchStartIndex;if(s>r){var c=o-(s-r),l=n.substring(c,o);("@"!==l||e.search)&&(c>=i?a.search=e.search.substring(0,c-1)+l+e.search.substring(o-2):a=_objectSpread({},a,{},t.getDefaultSearchState(),{suggestionsOpen:"@"===l}))}else{var m=r-s;o>=i?a.search=e.search.substring(0,o-i)+e.search.substring(o+m-i):a=_objectSpread({},a,{},t.getDefaultSearchState())}}return t.removeUnusedTags(n),a})}},{key:"replaceSearchWithUsername",value:function replaceSearchWithUsername(e){var t=this,n=this.getFilteredTeamUsers();this.setState(function(o){var s=e||i.a.get(n,[o.focused,"username"]),r=e?i.a.find(n,{username:e}):i.a.get(n,o.focused);if(s)return t.addTag(r),_objectSpread({body:o.body.substring(0,o.searchStartIndex)+s+" "+o.body.substring(o.searchStartIndex+o.search.length)},t.getDefaultSearchState())})}},{key:"scrollFocusedSuggestionIntoView",value:function scrollFocusedSuggestionIntoView(){var e=this.suggestionsList&&this.suggestionsList.getElementsByClassName("focused");e&&e[0]&&e[0].scrollIntoView({block:"nearest"})}},{key:"handleKeyDown",value:function handleKeyDown(e){var t=this,n=this.getFilteredTeamUsers(),o=e.target.selectionStart;return this.state.suggestionsOpen?("ArrowDown"===e.key&&(this.setState(function(e){if(e.focused<n.length-1)return{focused:e.focused+1}}),e.preventDefault()),"ArrowUp"===e.key&&(this.setState(function(e){if(e.focused>0)return{focused:e.focused-1}}),e.preventDefault()),"Enter"===e.key&&(this.replaceSearchWithUsername(),e.preventDefault()),void("Escape"===e.key&&(this.setState(this.getDefaultSearchState()),e.preventDefault()))):13===e.keyCode&&(e.ctrlKey||e.metaKey)?(this.handleConfirm(),void e.preventDefault()):void("@"===e.key&&this.setState(function(e){if(0===o||/\s/.test(e.body[o-1]))return _objectSpread({},t.getDefaultSearchState(),{suggestionsOpen:!0,searchStartIndex:o+1})}))}},{key:"searchFilter",value:function searchFilter(e){if((this.props.user||{}).id===e.id)return!1;if(!this.state.search)return!0;var t=this.state.search.toLocaleLowerCase();return(e.name||"").toLowerCase().includes(t)||(e.username||"").toLowerCase().includes(t)}},{key:"setSuggestionsRef",value:function setSuggestionsRef(e){this.suggestionsList=e}},{key:"render",value:function render(){var e=this,t=this.props.user||{},n=this.getFilteredTeamUsers();return s.a.createElement("div",{className:"comments-input"},s.a.createElement(m.c,{to:"/users/".concat(t.id)},s.a.createElement(r.UserIcon,{size:"sm",url:t.profilePicUrl,userId:t.id})),s.a.createElement("textarea",{className:"pm-form-control pm-textarea push-half--bottom",rows:2,value:this.state.body,onChange:this.handleChange,onKeyDown:this.handleKeyDown}),n.length>0&&this.state.suggestionsOpen&&s.a.createElement("ul",{className:"comments-tag-list",ref:this.setSuggestionsRef},n.map(function(t,n){return s.a.createElement("li",{className:l()("comments-tag-list__item",{focused:n===e.state.focused}),id:t.id,key:t.id,onClick:function onClick(){e.replaceSearchWithUsername(t.username)}},t.username||t.name)})),s.a.createElement(r.Button,{className:"comments-input__confirm",disabled:this.props.disabled||this.props.loading,pmStyle:"primary",size:"sm",onClick:this.handleConfirm},this.props.loading?s.a.createElement(r.Loader,null):this.props.confirmLabel||"Add comment"),s.a.createElement("span",{className:"pm-link-secondary comments-input__cancel",onClick:this.props.onCancel},"Cancel"))}}]),CommentInput}(),u=n("Bdpz"),f=n("htxa");function Comment_typeof(e){return(Comment_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Comment_defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Comment_getPrototypeOf(e){return(Comment_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Comment_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Comment_setPrototypeOf(e,t){return(Comment_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function Comment(e){var t;return function Comment_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Comment),(t=function Comment_possibleConstructorReturn(e,t){return!t||"object"!==Comment_typeof(t)&&"function"!=typeof t?Comment_assertThisInitialized(e):t}(this,Comment_getPrototypeOf(Comment).call(this,e))).state={editing:!1},t.replaceUsernamesWithTags=t.replaceUsernamesWithTags.bind(Comment_assertThisInitialized(t)),t.escapeUsernames=t.escapeUsernames.bind(Comment_assertThisInitialized(t)),t.parseCommentBody=t.parseCommentBody.bind(Comment_assertThisInitialized(t)),t.handleLinkClick=t.handleLinkClick.bind(Comment_assertThisInitialized(t)),t}return function Comment_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Comment_setPrototypeOf(e,t)}(Comment,o["PureComponent"]),function Comment_createClass(e,t,n){return t&&Comment_defineProperties(e.prototype,t),n&&Comment_defineProperties(e,n),e}(Comment,[{key:"handleLinkClick",value:function handleLinkClick(e){var t=e.target;if("comments-tag"!==t.className){var n=t.getAttribute("href");n&&u.s.goToExternalRoute(n)}else if("user"===t.getAttribute("data-type")){var o=t.getAttribute("data-id");u.s.goToRoute("/users/".concat(o))}}},{key:"parseCommentBody",value:function parseCommentBody(e,t){var n=e;return n=this.escapeUsernames(e,t),n=Object(f.ib)(n),n=Object(f.jb)(n),n=this.replaceUsernamesWithTags(n,t)}},{key:"escapeUsernames",value:function escapeUsernames(e,t){var n=e;return i.a.isEmpty(t)?n:(i.a.forEach(t,function(e,t){n=n.replace(new RegExp(u.t.escapeRegExp(t),"gi"),t)}),n)}},{key:"replaceUsernamesWithTags",value:function replaceUsernamesWithTags(e,t){var n=this.props.teamUsersMap,o=e;return i.a.isEmpty(t)?o:(i.a.forEach(t,function(e,t){var s=n[e.id]||{name:"User-".concat(e.id)},r='<a class="comments-tag" data-id="'.concat(s.id,'" data-type="user">').concat(i.a.escape(s.username||s.name),"</a>");o=o.replace(new RegExp(u.t.escapeRegExp(t),"gi"),r)}),o)}},{key:"render",value:function render(){var e=this,t=this.props.createdBy||{},n={"comments-item":!0,"comments-item--editable":this.props.editable,"comments-item--deleting":this.props.deleting};return this.state.editing?s.a.createElement(p,{confirmLabel:"Save changes",loading:this.props.updating,tags:this.props.tags,teamUsers:this.props.teamUsers,user:this.props.user,value:this.props.body,onCancel:function onCancel(){e.setState({editing:!1})},onConfirm:function onConfirm(t,n){e.props.onUpdate({commentId:e.props.id,body:t,tags:n})}}):s.a.createElement("li",{className:l()(n)},this.props.editable&&s.a.createElement("div",{className:"comments-item__actions"},s.a.createElement(r.Button,{className:"push-half--right",disabled:this.props.deleting,icon:"edit",pmStyle:"alternate",size:"xs",onClick:function onClick(){e.setState({editing:!0})}}),s.a.createElement(r.Button,{disabled:this.props.deleting,icon:"delete",pmStyle:"alternate",size:"xs",onClick:function onClick(){e.props.onDelete(e.props.id)}})),s.a.createElement(m.c,{to:"/users/".concat(t.id)},s.a.createElement(r.UserIcon,{size:"sm",url:t.profilePicUrl,userId:t.id})),s.a.createElement(m.c,{className:"pm-link comments-item__creator",title:t.friendly,to:"/users/".concat(t.id)},t.friendly),s.a.createElement("small",{className:"comments-item__time"},u.h.getRelativeTime(this.props.createdAt)),s.a.createElement("div",{className:"pm-markdown",dangerouslySetInnerHTML:{__html:this.parseCommentBody(this.props.body,this.props.tags)},onClick:this.handleLinkClick}))}}]),Comment}();function Comments_typeof(e){return(Comments_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Comments_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Comments_defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Comments_createClass(e,t,n){return t&&Comments_defineProperties(e.prototype,t),n&&Comments_defineProperties(e,n),e}function Comments_possibleConstructorReturn(e,t){return!t||"object"!==Comments_typeof(t)&&"function"!=typeof t?function Comments_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Comments_getPrototypeOf(e){return(Comments_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Comments_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Comments_setPrototypeOf(e,t)}function Comments_setPrototypeOf(e,t){return(Comments_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function CommentList(e){return s.a.createElement("ul",{className:"comments-list",ref:e.listRef},e.comments.map(function(t){return s.a.createElement(d,_extends({deleteError:e.deleteError,deleting:e.deleting.includes(t.id),editable:t.createdBy.id===e.user.id,key:"".concat(t.id,"-").concat(t.updatedAt),teamUsers:e.teamUsers,teamUsersMap:e.teamUsersMap,updateError:e.updateError,updating:e.updating.includes(t.id),user:e.user,onDelete:e.onDelete,onUpdate:e.onUpdate},t))}))}n.d(t,"a",function(){return h}),n.d(t,"b",function(){return y});var h=function(e){function CommentPopover(e){var t;return Comments_classCallCheck(this,CommentPopover),(t=Comments_possibleConstructorReturn(this,Comments_getPrototypeOf(CommentPopover).call(this,e))).listRef=s.a.createRef(),t}return Comments_inherits(CommentPopover,o["Component"]),Comments_createClass(CommentPopover,[{key:"componentDidMount",value:function componentDidMount(){var e=this;this.timeout=setTimeout(function(){e.scrollListToBottom()},0)}},{key:"componentDidUpdate",value:function componentDidUpdate(e){this.props.loading||!e.loading||this.props.loadError||this.scrollListToBottom(),i.a.get(this.props.data,"length")>i.a.get(e.data,"length")&&this.scrollListToBottom()}},{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.timeout)}},{key:"scrollListToBottom",value:function scrollListToBottom(){var e=this.listRef.current;e&&(e.scrollTop=e.scrollHeight)}},{key:"render",value:function render(){return this.props.loading?s.a.createElement("div",{className:"comments"},s.a.createElement(r.Loader,{className:"pm-absolute-center",pmStyle:"secondary",size:"xl"})):this.props.loadError?s.a.createElement("div",{className:"comments"},s.a.createElement(f.v,{body:"There was an error while fetching comments. Please try again.",className:"push-double",imageSrc:"".concat("https://static.postman.co/img","/warning.svg"),title:"Something went wrong"})):this.props.loaded?s.a.createElement("div",{className:l()("comments",this.props.className)},s.a.createElement(CommentList,{comments:this.props.data,deleteError:this.props.deleteError,deleting:this.props.deleting,listRef:this.listRef,teamUsers:this.props.teamUsers,teamUsersMap:this.props.teamUsersMap,updateError:this.props.updateError,updating:this.props.updating,user:this.props.user,onDelete:this.props.onCommentDelete,onUpdate:this.props.onCommentUpdate}),s.a.createElement(p,{loading:this.props.creating.includes(this.props.anchor),resetAfterLoad:!this.props.createError,teamUsers:this.props.teamUsers,user:this.props.user,value:this.props.body,onCancel:this.props.onClose,onConfirm:this.props.onCommentCreate})):null}}]),CommentPopover}(),y=function(e){function Comments(e){var t;return Comments_classCallCheck(this,Comments),(t=Comments_possibleConstructorReturn(this,Comments_getPrototypeOf(Comments).call(this,e))).state={open:e.open||!1},t.listRef=s.a.createRef(),t}return Comments_inherits(Comments,o["Component"]),Comments_createClass(Comments,[{key:"render",value:function render(){var e=this,t=s.a.createElement(h,_extends({},this.props.comments,{anchor:this.props.anchor,teamUsers:i.a.filter(this.props.teamUsers,function(t){return"".concat(t.id)!=="".concat(i.a.get(e.props.user,"id"))}),teamUsersMap:this.props.teamUsers,user:this.props.user,onClose:function onClose(){e.setState({open:!1})},onCommentCreate:this.props.onCommentCreate,onCommentDelete:this.props.onCommentDelete,onCommentUpdate:this.props.onCommentUpdate}));return s.a.createElement(r.Popover,{closeOnEscape:!0,content:t,open:this.state.open,onEscape:function onEscape(){e.setState({open:!1})},onTriggerClick:function onTriggerClick(){e.setState(function(e){return{open:!e.open}})}},function(t){return s.a.createElement("span",{className:"pm-link docs-desc-comments",ref:t.triggerRef,onClick:t.onClick},s.a.createElement(r.Icon,{name:"comment",pmStyle:"primary",size:"sm"}),s.a.createElement("span",{className:"docs-desc-comments__label"},"Comments"),"(",i.a.get(e.props,"comments.data.length"),")")})}}]),Comments}()}}]);